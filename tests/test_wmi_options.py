import pydantic
import pytest
from wmi_exploiter.wmi_options import WMIOptions

UPLOAD_TIMEOUT = 12.4

WMI_OPTIONS_DICT = {
    "agent_binary_upload_timeout": UPLOAD_TIMEOUT,
}

WMI_OPTIONS_OBJECT = WMIOptions(
    agent_binary_upload_timeout=UPLOAD_TIMEOUT,
)

UPLOAD_TIMEOUT_EXCEPTION = {"agent_binary_upload_timeout": 70000}


def test_wmi_options__serialization():
    assert WMI_OPTIONS_OBJECT.dict(simplify=True) == WMI_OPTIONS_DICT


def test_wmi_options__full_serialization():
    assert WMIOptions(**WMI_OPTIONS_OBJECT.dict(simplify=True)) == WMI_OPTIONS_OBJECT


def test_wmi_options__deserialization():
    assert WMIOptions(**WMI_OPTIONS_DICT) == WMI_OPTIONS_OBJECT


def test_wmi_options__default():
    wmi_options = WMIOptions()

    assert wmi_options.agent_binary_upload_timeout == 30.0


def test_wmi_options_constrains():
    with pytest.raises(pydantic.errors.NumberNotLeError):
        WMIOptions(**UPLOAD_TIMEOUT_EXCEPTION)
